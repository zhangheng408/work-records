###### 2018-05-02 星期三

- RISCV时钟
  - cycle/time/instret 只读用户态计数器
  - mtime/mtimecmp
    - mtime以固定频率运行
    - 平台提供一种机制决定mtime的timebase
    - mtimecmp小于或等于mtime触发中断
    - 系统态，只能通过sbi操作时钟

###### 2018-05-03 星期四

- sip
  - mip 8->80->280
    - msoft->mtimer-> sext/mtimer
  - mie 8->22a
    - msoft -> ssoft/stimer/msoft/sext
  - mideleg 222
    - ssoft/stimer/sext

###### 2018-05-04 星期五

- MIP
  - 时钟
    - MTIP位是只读的，只能通过写时钟清除
    - STIP/UTIP，由更高特权软件设置、清除
  - 软件中断
    - MSIP用于核间中断，通过MMIO写入
    - SSIP/USIP由软件读写
  - 外部中断
    - MEIP只读，由中断控制器设置
    - SEIP
      - 可由M态设置
      - 但读取的值时候是SEIP or 中断控制器
    - UEIP 只在N拓展中支持
  - 中断触发
    - mip/mie的相应位为被设置
    - 且中断全局使能
      - 如当前特权等级低于中断特权等级
      - 或MSTATUS中当前特权等级中断使能位被设置

###### 2018-05-06 星期六

- mtimer需要BBL设置，而BBL的接口等待linux调用
  - 默认mie不设置mtimer，linux调用BBL之后才支持
- Linux没有实现时钟相关，没有调用BBL的时钟接口
  - Linux中的hrtimer需要HIGH_RES_TIMERS
- Linux启动的输出
  - clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns
- printk输出的时间戳
  - 在cont_add函数中，利用local_clock函数获取
- Linux中的时钟
  - xtime 物理世界时间
  - Jiffies 启动以来的时间

###### 2018-05-07 星期一

- 需要做的事情
  - time_init
    - 初始化xtime，设定中断
  - 时钟中断
    - do_timer
    - update_RTC 这个和定时器相同吗？
- Linux内核中时钟支持
  - 参考arm实现一个简单版本
  - printk时间戳更新了
  - sleep也能过去了
- 虚拟机的时钟支持
  - 正在加
- 主机关机
  - halt
    - 只有这个命令调用了reboot系统调用，cmd为0
    - 但内核只是将C_A_D变量设置为0
  - poweroff/reboot
    - 只有一个sleep输出
  - 参数加上-f就行了
    - reboot还不行，不支持重启